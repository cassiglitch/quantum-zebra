<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Portal Animation with Duration and Maximum Radius</title>
    <style>
        body, html {
            margin: 0;
            overflow: hidden;
            background-color: black;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
        }
        canvas {
            border: 1px solid #fff;
        }
    </style>
</head>
<body>
    <canvas id="portalCanvas"></canvas>
    <script>
        function createPortalAnimation(x, y, maxSize, duration) {
            const canvas = document.getElementById('portalCanvas');
            const ctx = canvas.getContext('2d');
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;

            const portalCenter = { x: x, y: y };
            let portalRadius = 0;
            const maxRadius = Math.min(maxSize, Math.hypot(canvas.width, canvas.height) / 2);

            let particles = [];
            const numParticles = 200;
            let particleRadius = 3;
            let startTime;

            // Initialize particles
            for (let i = 0; i < numParticles; i++) {
                particles.push({
                    angle: Math.random() * 2 * Math.PI,
                    distance: Math.random() * portalRadius,
                    speed: Math.random() * 0.05 + 0.01,
                    color: `hsl(${Math.random() * 60 + 60}, 100%, 50%)` // Greenish colors
                });
            }

            // Draw a single particle
            function drawParticle(particle) {
                ctx.beginPath();
                ctx.arc(
                    portalCenter.x + particle.distance * Math.cos(particle.angle),
                    portalCenter.y + particle.distance * Math.sin(particle.angle),
                    particleRadius,
                    0,
                    2 * Math.PI
                );
                ctx.fillStyle = particle.color;
                ctx.fill();
            }

            // Update particles
            function updateParticles() {
                for (let particle of particles) {
                    particle.angle += particle.speed;
                    particle.distance += particle.speed * 10;

                    // Reset particle if it goes beyond max radius
                    if (particle.distance > portalRadius) {
                        particle.angle = Math.random() * 2 * Math.PI;
                        particle.distance = Math.random() * portalRadius;
                    }
                }
            }

            // Draw portal
            function drawPortal(timestamp) {
                if (!startTime) startTime = timestamp;
                const elapsedTime = timestamp - startTime;

                ctx.clearRect(0, 0, canvas.width, canvas.height);

                // Update and draw particles
                updateParticles();
                for (let particle of particles) {
                    drawParticle(particle);
                }

                // Draw portal effect
                const gradient = ctx.createRadialGradient(
                    portalCenter.x, portalCenter.y, portalRadius / 2,
                    portalCenter.x, portalCenter.y, portalRadius
                );
                gradient.addColorStop(0, 'rgba(255, 255, 255, 0.5)');
                gradient.addColorStop(0.5, 'rgba(0, 0, 255, 0.5)');
                gradient.addColorStop(1, 'rgba(0, 0, 0, 0.5)');

                ctx.beginPath();
                ctx.arc(portalCenter.x, portalCenter.y, portalRadius, 0, Math.PI * 2);
                ctx.fillStyle = gradient;
                ctx.fill();

                // Update portal radius
                if (portalRadius < maxRadius && elapsedTime < duration) {
                    portalRadius += 2;
                } else if (portalRadius > 0) {
                    // Collapse the portal
                    portalRadius -= 2;
                }

                // Exit the function if both conditions are met
                if (portalRadius > 0 || elapsedTime < duration) {
                    requestAnimationFrame(drawPortal);
                }
            }

            // Start animation
            requestAnimationFrame(drawPortal);
        }

        // Call the function with desired parameters
        createPortalAnimation(window.innerWidth / 2, window.innerHeight / 2, 300, 5000); // Example parameters
    </script>
</body>
</html>
